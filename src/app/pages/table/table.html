<div class="min-h-screen bg-gradient-to-br from-slate-50 via-gray-50 to-slate-100 py-8 px-4 sm:px-6 lg:px-8">
	<div class="max-w-7xl mx-auto">
		
		<!-- Header - Config-driven -->
		<div class="mb-8 animate-fade-in">
			<h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 mb-1">
				{{ tableConfig.title }}
			</h1>
			<p class="text-slate-600">{{ tableConfig.subtitle }}</p>
		</div>

		<!-- Notification Toast -->
		@if (notification()) {
			<div 
				class="fixed top-4 right-4 z-50 animate-slide-in-right"
				[class]="notification()?.type === 'success' 
					? 'bg-emerald-500' 
					: 'bg-red-500'"
			>
				<div class="flex items-center gap-3 px-6 py-4 rounded-xl text-white shadow-2xl">
					@if (notification()?.type === 'success') {
						<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
						</svg>
					} @else {
						<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
						</svg>
					}
					<span class="font-medium">{{ notification()?.message }}</span>
				</div>
			</div>
		}

		<!-- Filters Section - Config-driven -->
		<div class="bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl shadow-xl p-6 mb-6 animate-fade-in">
			<div class="grid gap-6 md:grid-cols-4">
				
				@for (filter of tableConfig.filters; track filter.key) {
					@if (filter.type === 'search') {
						<!-- Search Input -->
						<div class="md:col-span-1">
							<label class="block text-sm font-semibold text-slate-300 mb-2 flex items-center gap-2">
								<svg class="w-4 h-4 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
								</svg>
								{{ filter.label }}
							</label>
							<div class="relative group">
								<input
									type="text"
									[value]="searchQuery()"
									(input)="updateSearch($any($event.target).value)"
									[placeholder]="filter.placeholder || 'Search...'"
									class="w-full pl-11 pr-4 py-3 bg-slate-700/50 border-2 border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 focus:bg-slate-700 transition-all duration-300 hover:border-slate-500"
								/>
								<svg class="absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-amber-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
								</svg>
							</div>
						</div>
					} @else {
						<!-- Select Filter -->
						<div>
							<label class="block text-sm font-semibold text-slate-300 mb-2 flex items-center gap-2">
								<svg class="w-4 h-4 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
								</svg>
								{{ filter.label }}
							</label>
							<div class="relative">
								<select
									[value]="getFilterValue(filter.key)"
									(change)="updateFilter(filter.key, $any($event.target).value)"
									class="w-full pl-4 pr-10 py-3 bg-slate-700/50 border-2 border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 focus:bg-slate-700 transition-all duration-300 appearance-none cursor-pointer hover:border-slate-500"
								>
									@for (option of filter.options; track option.value) {
										<option [value]="option.value" class="bg-slate-800">{{ option.label }}</option>
									}
								</select>
								<svg class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-amber-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
								</svg>
							</div>
						</div>
					}
				}

				<!-- Clear Filters -->
				<div class="flex items-end">
					@if (hasActiveFilters()) {
						<button
							(click)="clearFilters()"
							class="w-full px-4 py-3 bg-red-500/20 border-2 border-red-500/50 text-red-300 font-semibold rounded-xl hover:bg-red-500/30 hover:border-red-400 transition-all duration-300 flex items-center justify-center gap-2"
						>
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
							</svg>
							Clear Filters
						</button>
					} @else {
						<div class="w-full px-4 py-3 bg-slate-700/30 border-2 border-dashed border-slate-600 text-slate-500 font-medium rounded-xl flex items-center justify-center gap-2">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
							</svg>
							No active filters
						</div>
					}
				</div>
			</div>
		</div>

		<!-- Table Container -->
		<div class="bg-white rounded-2xl shadow-lg shadow-slate-200 overflow-hidden animate-fade-in">
			
			<!-- Table - Config-driven columns -->
			<div class="overflow-x-auto">
				<table class="w-full">
					<thead>
						<tr class="bg-gradient-to-r from-slate-800 to-slate-900 text-white">
							@for (column of tableConfig.columns; track column.key) {
								<th class="text-center px-4 py-4 font-semibold text-sm uppercase tracking-wider border-r border-slate-700/50">
									@if (column.sortable) {
										<button
											(click)="toggleSort(column.key)"
											class="inline-flex items-center gap-2 hover:text-amber-400 transition-colors duration-200 mx-auto"
										>
											{{ column.label }}
											<span 
												class="w-6 h-6 rounded-md flex items-center justify-center text-xs transition-all duration-200"
												[class]="sortColumn() === column.key ? 'bg-amber-500 text-white' : 'bg-slate-700 text-slate-400'"
											>
												{{ getSortIcon(column.key) }}
											</span>
										</button>
									} @else {
										{{ column.label }}
									}
								</th>
							}
							<th class="text-center px-4 py-4 font-semibold text-sm uppercase tracking-wider">Actions</th>
						</tr>
					</thead>
					<tbody class="divide-y divide-slate-200">
						@for (row of filteredAndSortedData(); track row.id; let i = $index; let odd = $odd) {
							<tr 
								class="group transition-all duration-200 hover:bg-amber-50"
								[class]="odd ? 'bg-slate-50/50' : 'bg-white'"
							>
								@for (column of tableConfig.columns; track column.key) {
									<td class="px-4 py-4 text-center border-r border-slate-200">
										@switch (column.type) {
											@case ('badge') {
												<span 
													class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
													[class]="getBadgeColors(row[column.key]).bg + ' ' + getBadgeColors(row[column.key]).text"
												>
													{{ row[column.key] }}
												</span>
											}
											@case ('currency') {
												<span class="font-bold text-slate-900">{{ formatCurrency(row[column.key]) }}</span>
											}
											@case ('date') {
												<span class="text-slate-600 text-sm">{{ formatDate(row[column.key]) }}</span>
											}
											@default {
												<span class="text-slate-700">{{ row[column.key] }}</span>
											}
										}
									</td>
								}
								<td class="px-4 py-4">
									<div class="flex items-center justify-center gap-2">
										<!-- Edit Button -->
										<button
											(click)="openEditModal(row)"
											class="w-9 h-9 flex items-center justify-center rounded-lg bg-amber-100 text-amber-700 hover:bg-amber-500 hover:text-white transition-all duration-200 hover:scale-110 hover:shadow-lg"
											title="Edit"
										>
											<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
											</svg>
										</button>
										<!-- Delete Button -->
										<button
											(click)="openDeleteModal(row)"
											class="w-9 h-9 flex items-center justify-center rounded-lg bg-red-100 text-red-700 hover:bg-red-500 hover:text-white transition-all duration-200 hover:scale-110 hover:shadow-lg"
											title="Delete"
										>
											<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
											</svg>
										</button>
									</div>
								</td>
							</tr>
						} @empty {
							<tr>
								<td [attr.colspan]="tableConfig.columns.length + 1" class="px-4 py-12 text-center">
									<div class="flex flex-col items-center gap-4">
										<div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center">
											<svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
											</svg>
										</div>
										<div class="text-slate-500">No records found matching your filters</div>
										<button
											(click)="clearFilters()"
											class="text-amber-600 hover:text-amber-700 font-medium"
										>
											Clear all filters
										</button>
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>

			<!-- Table Footer - Config-driven -->
			<div class="px-6 py-4 bg-slate-50 border-t border-slate-200 flex flex-col sm:flex-row items-center justify-between gap-4">
				<p class="text-sm text-slate-600">
					Showing <span class="font-bold text-slate-900">{{ filteredRecords() }}</span> 
					of <span class="font-bold text-slate-900">{{ totalRecords() }}</span> records
				</p>
				<button
					(click)="addNewRecord()"
					class="inline-flex items-center gap-2 px-4 py-2 bg-slate-900 hover:bg-slate-800 text-white font-medium rounded-xl transition-all duration-200 hover:shadow-lg"
				>
					<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
					</svg>
					{{ tableConfig.addButtonLabel }}
				</button>
			</div>
		</div>
	</div>
</div>

<!-- ==================== -->
<!-- EDIT MODAL - Config-driven with Validation -->
<!-- ==================== -->
@if (isEditModalOpen()) {
	<div class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fade-in">
		<!-- Backdrop -->
		<div 
			class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm"
			(click)="closeEditModal()"
		></div>
		
		<!-- Modal -->
		<div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden animate-scale-in">
			<!-- Header -->
			<div class="bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-4">
				<div class="flex items-center justify-between">
					<h2 class="text-xl font-bold text-white">
						{{ editFormData()['id'] ? tableConfig.editModalTitle : 'Add New Record' }}
					</h2>
					<button
						(click)="closeEditModal()"
						class="w-8 h-8 flex items-center justify-center rounded-lg bg-white/20 hover:bg-white/30 text-white transition-colors duration-200"
					>
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
						</svg>
					</button>
				</div>
			</div>

			<!-- Form - Config-driven fields with validation -->
			<div class="p-6 overflow-y-auto max-h-[calc(90vh-140px)]">
				<div class="grid gap-5 md:grid-cols-2">
					@for (column of tableConfig.columns; track column.key) {
						@if (column.editable) {
							<div>
								<label class="block text-sm font-semibold text-slate-700 mb-2">
									{{ column.label }}
									@if (validationRules[column.key]) {
										<span class="text-red-500">*</span>
									}
								</label>
								
								@switch (column.inputType) {
									@case ('select') {
										<select
											[value]="editFormData()[column.key] || ''"
											(change)="updateEditField(column.key, $any($event.target).value)"
											class="w-full px-4 py-2.5 border rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-all duration-200 bg-white appearance-none cursor-pointer"
											[class]="hasFieldError(column.key) ? 'border-red-500' : 'border-slate-300'"
										>
											<option value="">Select {{ column.label.toLowerCase() }}</option>
											@for (option of column.options; track option.value) {
												<option [value]="option.value">{{ option.label }}</option>
											}
										</select>
									}
									@case ('number') {
										<input
											type="number"
											[value]="editFormData()[column.key] || 0"
											(input)="updateEditField(column.key, +$any($event.target).value)"
											[placeholder]="'Enter ' + column.label.toLowerCase()"
											class="w-full px-4 py-2.5 border rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-all duration-200"
											[class]="hasFieldError(column.key) ? 'border-red-500' : 'border-slate-300'"
										/>
									}
									@case ('date') {
										<input
											type="date"
											[value]="editFormData()[column.key] || ''"
											(input)="updateEditField(column.key, $any($event.target).value)"
											class="w-full px-4 py-2.5 border rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-all duration-200"
											[class]="hasFieldError(column.key) ? 'border-red-500' : 'border-slate-300'"
										/>
									}
									@case ('email') {
										<input
											type="email"
											[value]="editFormData()[column.key] || ''"
											(input)="updateEditField(column.key, $any($event.target).value)"
											[placeholder]="'Enter ' + column.label.toLowerCase()"
											class="w-full px-4 py-2.5 border rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-all duration-200"
											[class]="hasFieldError(column.key) ? 'border-red-500' : 'border-slate-300'"
										/>
									}
									@case ('tel') {
										<input
											type="tel"
											[value]="editFormData()[column.key] || ''"
											(input)="updateEditField(column.key, $any($event.target).value)"
											placeholder="+1 555-0100"
											class="w-full px-4 py-2.5 border rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-all duration-200"
											[class]="hasFieldError(column.key) ? 'border-red-500' : 'border-slate-300'"
										/>
									}
									@default {
										<input
											type="text"
											[value]="editFormData()[column.key] || ''"
											(input)="updateEditField(column.key, $any($event.target).value)"
											[placeholder]="'Enter ' + column.label.toLowerCase()"
											class="w-full px-4 py-2.5 border rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-all duration-200"
											[class]="hasFieldError(column.key) ? 'border-red-500' : 'border-slate-300'"
										/>
									}
								}

								<!-- Validation Error -->
								@if (hasFieldError(column.key)) {
									<p class="mt-1 text-sm text-red-500 flex items-center gap-1">
										<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
										</svg>
										{{ getFieldError(column.key) }}
									</p>
								}
							</div>
						}
					}
				</div>
			</div>

			<!-- Footer -->
			<div class="px-6 py-4 bg-slate-50 border-t border-slate-200 flex items-center justify-end gap-3">
				<button
					(click)="closeEditModal()"
					class="px-5 py-2.5 border-2 border-slate-300 text-slate-700 font-medium rounded-xl hover:bg-slate-100 hover:border-slate-400 transition-all duration-200"
				>
					Cancel
				</button>
				<button
					(click)="saveRecord()"
					class="px-5 py-2.5 bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-800 hover:to-slate-900 text-white font-semibold rounded-xl shadow-lg shadow-slate-300 transition-all duration-200 hover:shadow-xl"
				>
					Save Changes
				</button>
			</div>
		</div>
	</div>
}

<!-- ==================== -->
<!-- DELETE CONFIRMATION MODAL -->
<!-- ==================== -->
@if (isDeleteModalOpen()) {
	<div class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fade-in">
		<!-- Backdrop -->
		<div 
			class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm"
			(click)="closeDeleteModal()"
		></div>
		
		<!-- Modal -->
		<div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-scale-in">
			<div class="p-6 text-center">
				<!-- Icon -->
				<div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
					<svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
					</svg>
				</div>

				<!-- Text -->
				<h3 class="text-xl font-bold text-slate-900 mb-2">{{ tableConfig.deleteModalTitle }}?</h3>
				<p class="text-slate-600 mb-6">
					Are you sure you want to delete 
					<span class="font-semibold text-slate-900">
						{{ deletingRecord()?.['firstName'] }} {{ deletingRecord()?.['lastName'] }}
					</span>?
					This action cannot be undone.
				</p>

				<!-- Buttons -->
				<div class="flex items-center justify-center gap-3">
					<button
						(click)="closeDeleteModal()"
						class="px-5 py-2.5 border-2 border-slate-300 text-slate-700 font-medium rounded-xl hover:bg-slate-100 hover:border-slate-400 transition-all duration-200"
					>
						Cancel
					</button>
					<button
						(click)="confirmDelete()"
						class="px-5 py-2.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold rounded-xl shadow-lg shadow-red-200 transition-all duration-200 hover:shadow-xl"
					>
						Delete
					</button>
				</div>
			</div>
		</div>
	</div>
}
